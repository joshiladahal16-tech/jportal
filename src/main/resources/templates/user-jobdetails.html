<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${job != null ? job.title + ' · Job Portal' : 'Job Details · Job Portal'}">Job Details · Job Portal</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- ✅ Correct for static root -->
    <link rel="stylesheet" th:href="@{/styles.css}" />
    <script th:src="@{/navbar.js}"></script>

    <meta
            name="description"
            th:content="${job != null ? 'Apply for ' + job.title + ' at ' + job.company + '. ' + job.description : 'Find your next career opportunity on our job portal.'}"
            content="Find your next career opportunity on our job portal."
    />
</head>
<body>
<header class="site-header">
    <div class="container nav">
        <a class="brand" th:href="@{/}"
        ><i class="fa-solid fa-briefcase"></i> Job Portal</a
        >
        <nav class="nav-links">
            <!-- Navbar will be populated by JavaScript -->
        </nav>
    </div>
</header>

<main class="section">
    <div class="container">
        <!-- Job Details Card -->
        <div class="card">
            <div style="display: flex; align-items: center; gap: 1rem">
                <!-- Company Logo -->
                <div
                        class="logo"
                        style="
                            width: 72px;
                            height: 72px;
                            display: grid;
                            place-items: center;
                        "
                >
                    <!-- Dynamic logo if available, fallback to icon -->
                    <div th:if="${job != null and job.companyLogo != null}">
                        <img
                                th:src="${job.companyLogo}"
                                th:alt="${job.company + ' logo'}"
                                style="width: 72px; height: 72px; border-radius: 12px; object-fit: cover;"
                        />
                    </div>
                    <div th:unless="${job != null and job.companyLogo != null}">
                        <i
                                class="fa-solid fa-pen-ruler"
                                style="color: #7b43f6; font-size: 1.6rem"
                        ></i>
                    </div>
                </div>

                <!-- Job Title and Company Info -->
                <div>
                    <h1 style="margin: 0.2rem 0 0.2rem"
                        th:text="${job != null ? job.title : 'Senior Product Designer'}">
                        Senior Product Designer
                    </h1>
                    <div class="muted"
                         th:text="${job != null ? job.company + ' · ' + job.location + ' · ' + job.type : 'Sphere UI · Remote · Full‑time'}">
                        Sphere UI · Remote · Full‑time
                    </div>
                </div>

                <!-- Action Buttons -->
                <div style="margin-left: auto; display: flex; gap: 0.5rem">
                    <!-- Check if user is authenticated -->
                    <div th:if="${#authentication.isAuthenticated()}">
                        <a class="btn btn-primary" href="#apply">
                            <i class="fa-solid fa-paper-plane"></i> Apply Now
                        </a>
                    </div>
                    <div th:unless="${#authentication.isAuthenticated()}">
                        <a class="btn btn-primary" th:href="@{/login}">
                            <i class="fa-solid fa-paper-plane"></i> Apply Now
                        </a>
                        <a class="btn btn-outline" href="#apply">Already logged in?</a>
                    </div>
                </div>
            </div>

            <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1rem 0" />

            <!-- Job Details Grid -->
            <div class="grid grid-2">
                <!-- Left Column - Job Description -->
                <div>
                    <h3 style="margin: 0.2rem 0 0.4rem">About the role</h3>
                    <p class="muted"
                       th:text="${job != null ? job.description : 'You will lead end‑to‑end product design from discovery to delivery in a collaborative, fast‑paced environment.'}">
                        You will lead end‑to‑end product design from discovery to delivery in a collaborative, fast‑paced environment.
                    </p>

                    <h3 style="margin: 1rem 0 0.4rem">Requirements</h3>
                    <!-- Dynamic requirements if available -->
                    <div th:if="${job != null and job.requirements != null and !job.requirements.isEmpty()}">
                        <ul class="muted" style="margin: 0; padding-left: 1.1rem">
                            <li th:each="requirement : ${job.requirements}" th:text="${requirement}"></li>
                        </ul>
                    </div>
                    <!-- Fallback requirements -->
                    <div th:unless="${job != null and job.requirements != null and !job.requirements.isEmpty()}">
                        <ul class="muted" style="margin: 0; padding-left: 1.1rem">
                            <li>5+ years of product design experience</li>
                            <li>Portfolio demonstrating shipped work</li>
                            <li>Strong Figma and prototyping skills</li>
                        </ul>
                    </div>
                </div>

                <!-- Right Column - Compensation & Location -->
                <div>
                    <h3 style="margin: 0.2rem 0 0.4rem">Compensation</h3>
                    <p class="muted"
                       th:text="${job != null ? job.salary + (job.benefits != null ? ' · ' + job.benefits : '') : '$120k – $150k + equity · Health, WFH stipend, flexible hours'}">
                        $120k – $150k + equity · Health, WFH stipend, flexible hours
                    </p>

                    <h3 style="margin: 1rem 0 0.4rem">Location</h3>
                    <p class="muted"
                       th:text="${job != null ? job.location + (job.locationNotes != null ? ' (' + job.locationNotes + ')' : '') : 'Remote (India time overlap preferred)'}">
                        Remote (India time overlap preferred)
                    </p>
                </div>
            </div>
        </div>

        <!-- Application Form - Only show if user is authenticated -->
        <div id="apply" class="apply-now"
             th:style="${#authentication.isAuthenticated() ? 'display: block' : 'display: none'}">
            <div class="card apply-panel" style="margin-top: 1rem">
                <div class="notice" style="margin-bottom: 0.8rem">
                    Ready to apply? Fill out the form below to submit your application.
                </div>

                <!-- Application Form -->
                <form th:action="@{/jobs/{id}/apply(id=${job != null ? job.id : 1})}"
                      method="post"
                      th:object="${applicationForm}">

                    <!-- Hidden field for job ID -->
                    <input type="hidden" th:field="*{jobId}" th:value="${job != null ? job.id : 1}" />

                    <div class="row">
                        <div class="field">
                            <label for="fullName">Full name</label>
                            <input id="fullName"
                                   th:field="*{fullName}"
                                   placeholder="Your name"
                                   required />
                            <div th:if="${#fields.hasErrors('fullName')}"
                                 th:errors="*{fullName}"
                                 class="error-message"></div>
                        </div>
                        <div class="field">
                            <label for="email">Email</label>
                            <input id="email"
                                   type="email"
                                   th:field="*{email}"
                                   placeholder="you@example.com"
                                   required />
                            <div th:if="${#fields.hasErrors('email')}"
                                 th:errors="*{email}"
                                 class="error-message"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="field" style="grid-column: 1/-1">
                            <label for="coverLetter">Cover Letter</label>
                            <textarea id="coverLetter"
                                      th:field="*{coverLetter}"
                                      placeholder="Tell us why you're a great fit for this role..."
                                      rows="4"></textarea>
                            <div th:if="${#fields.hasErrors('coverLetter')}"
                                 th:errors="*{coverLetter}"
                                 class="error-message"></div>
                        </div>
                    </div>

                    <!-- File Upload for Resume (if supported) -->
                    <div class="row">
                        <div class="field" style="grid-column: 1/-1">
                            <label for="resume">Resume (PDF, DOC, DOCX)</label>
                            <input id="resume"
                                   type="file"
                                   name="resumeFile"
                                   accept=".pdf,.doc,.docx" />
                            <small class="muted">Maximum file size: 5MB</small>
                        </div>
                    </div>

                    <div class="form-actions" style="margin-top: 0.6rem">
                        <button class="btn btn-primary" type="submit">
                            <i class="fa-solid fa-paper-plane"></i> Submit Application
                        </button>
                        <a class="btn btn-outline" th:href="@{/jobs}">Cancel</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Login prompt for unauthenticated users -->
        <div th:unless="${#authentication.isAuthenticated()}"
             class="apply-now" style="display: block">
            <div class="card apply-panel" style="margin-top: 1rem">
                <div class="notice" style="margin-bottom: 0.8rem; text-align: center;">
                    <i class="fa-solid fa-lock" style="color: #7b43f6; margin-right: 0.5rem;"></i>
                    Please log in to apply for this position.
                </div>
                <div style="text-align: center;">
                    <a class="btn btn-primary" th:href="@{/login}">
                        <i class="fa-solid fa-sign-in-alt"></i> Login to Apply
                    </a>
                    <span style="margin: 0 0.5rem; color: #6b7280;">or</span>
                    <a class="btn btn-outline" th:href="@{/register}">
                        <i class="fa-solid fa-user-plus"></i> Create Account
                    </a>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<footer class="footer">
    <div class="footer-container">
        <!-- Logo / About -->
        <div class="footer-section about">
            <h2 class="footer-logo"><i class="fa-solid fa-fire"></i> Hot Jobs</h2>
            <p>
                Your trusted platform for high-intent job openings hand-picked daily.
            </p>
        </div>

        <!-- Quick Links -->
        <div class="footer-section links">
            <h3>Quick Links</h3>
            <ul>
                <li><a th:href="@{/}">Home</a></li>
                <li><a th:href="@{/jobs}">Browse Jobs</a></li>
                <li><a th:href="@{/employer/post-job}">Post a Job</a></li>
                <li><a th:href="@{/contact}">Contact</a></li>
            </ul>
        </div>

        <!-- Resources -->
        <div class="footer-section resources">
            <h3>Resources</h3>
            <ul>
                <li><a th:href="@{/blog}">Blog</a></li>
                <li><a th:href="@{/faq}">FAQs</a></li>
                <li><a th:href="@{/support}">Support</a></li>
                <li><a th:href="@{/privacy}">Privacy Policy</a></li>
            </ul>
        </div>

        <!-- Social -->
        <div class="footer-section social">
            <h3>Follow Us</h3>
            <div class="social-icons">
                <a href="#"><i class="fa-brands fa-facebook"></i></a>
                <a href="#"><i class="fa-brands fa-twitter"></i></a>
                <li><a href="#"><i class="fa-brands fa-linkedin"></i></a>
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        <p>© 2025 Hot Jobs. All Rights Reserved.</p>
    </div>
</footer>

<!-- Footer CSS -->
<style>
    .footer {
        background: #1a1a1a;
        color: #eee;
        padding: 2rem 1.5rem 1rem;
        margin-top: 2rem;
        font-family: Arial, sans-serif;
    }
    .footer-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 2rem;
        max-width: 1100px;
        margin: auto;
    }
    .footer-section h3,
    .footer-logo {
        margin-bottom: 1rem;
        color: #fff;
    }
    .footer-logo {
        font-size: 20px;
        font-weight: bold;
        color: #8b5cf6; /* purple accent */
    }
    .footer-section ul {
        list-style: none;
        padding: 0;
    }
    .footer-section ul li {
        margin: 0.5rem 0;
    }
    .footer-section ul li a {
        color: #ccc;
        text-decoration: none;
        transition: color 0.2s ease;
    }
    .footer-section ul li a:hover {
        color: #8b5cf6;
    }
    .footer .social-icons a {
        color: #ccc;
        margin-right: 10px;
        font-size: 18px;
        transition: color 0.2s ease;
    }
    .footer .social-icons a:hover {
        color: #8b5cf6;
    }
    .footer-bottom {
        text-align: center;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #333;
        font-size: 14px;
        color: #aaa;
    }

    /* Error message styling */
    .error-message {
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }

    /* Grid-2 utility class */
    .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.1rem;
    }
    @media (max-width: 680px) {
        .grid-2 {
            grid-template-columns: 1fr;
        }
    }
</style>
</body>
</html>